# This script should be called from Batsim's root directory

# If needed, the working directory of this script can be specified within this file
#base_working_directory: ~/proj/batsim

# If needed, the output directory of this script can be specified within this file
#base_output_directory: ~/proj/batsim/results

base_variables:
  agg_dir: ${base_output_directory}/aggregated

implicit_instances:
  implicit:
    sweep:
      platform :
        - {"name":"smallPF", "filename":"platforms/energy_platform_homogeneous_no_net_128.xml"}
      workload :
        - {"name":"tinyWL",   "filename": "workload_profiles/test_workload_profile.json"}
        - {"name":"mediumWL", "filename": "workload_profiles/batsim_paper_workload_example.json"}
      pybatsim_algo:
        - {"name": "filler", "pybatsim_name": "fillerSched"}
        - {"name": "easy",   "pybatsim_name": "easyBackfillNotopo"}
    generic_instance:
      timeout: 10
      working_directory: ${base_working_directory}
      output_directory: ${base_output_directory}/results/${pybatsim_algo["name"]}_${workload["name"]}_${platform["name"]}
      batsim_command: batsim -p ${platform["filename"]} -w ${workload["filename"]} -e ${output_directory}/out -s ${output_directory}/socket
      sched_command: python2 schedulers/pybatsim/launcher.py ${pybatsim_algo["pybatsim_name"]} -s ${output_directory}/socket

      commands_after_execution:
        - tools/batsim_output_csv_to_swf.py ${output_directory}/out_jobs.csv ${output_directory}/out_jobs.swf
        - cp ${output_directory}/out_jobs.csv ${agg_dir}/${pybatsim_algo["name"]}_${workload["name"]}_${platform["name"]}.csv
        - cp ${output_directory}/out_jobs.swf ${agg_dir}/${pybatsim_algo["name"]}_${workload["name"]}_${platform["name"]}.swf

commands_before_instances:
  - rm -rf ${agg_dir}
  - mkdir -p ${agg_dir}
